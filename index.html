<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Magic Jar</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      background: radial-gradient(circle at top, #1e1b4b, #020617);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: system-ui, sans-serif;
      color: white;
    }

    .scene { text-align: center; }

    .jar-wrapper {
      position: relative;
      width: 220px;
      height: 340px;
      margin-bottom: 24px;
    }

    .jar {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 280px;
      border-radius: 60px;
      background: linear-gradient(to bottom, rgba(165,243,252,0.35), rgba(99,102,241,0.3), rgba(236,72,153,0.35));
      border: 4px solid #bae6fd;
      backdrop-filter: blur(6px);
      box-shadow: 0 0 40px rgba(120,200,255,0.6);
      overflow: hidden;
      z-index: 1;
    }

    .neck {
      position: absolute;
      top: 4px;
      left: 50%;
      transform: translateX(-50%);
      width: 110px;
      height: 36px;
      border-radius: 20px;
      border: 4px solid #bae6fd;
      background: rgba(165,243,252,0.4);
      z-index: 3;
    }

    .lid {
      position: absolute;
      top: -46px;
      left: 50%;
      transform: translateX(-50%);
      width: 150px;
      height: 28px;
      border-radius: 999px;
      background: linear-gradient(to right, #fde68a, #f59e0b);
      transition: transform 0.5s ease, opacity 0.5s ease;
      z-index: 4;
    }

    .lid.open {
      transform: translate(-50%, -60px) rotate(-20deg);
      opacity: 0;
    }

    .ribbon {
      position: absolute;
      top: 50%;
      width: 100%;
      height: 22px;
      background: linear-gradient(to right, #ec4899, #a855f7);
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    }

    .star {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      animation: twinkle 2.5s infinite ease-in-out;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.4; transform: scale(0.8); }
      50% { opacity: 1; transform: scale(1.3); }
    }

    .shake { animation: shake 1.2s ease; }

    @keyframes shake {
      0% { transform: rotate(0deg); }
      20% { transform: rotate(-8deg); }
      40% { transform: rotate(8deg); }
      60% { transform: rotate(-8deg); }
      80% { transform: rotate(8deg); }
      100% { transform: rotate(0deg); }
    }

    .paper {
        position: absolute;
        left: 50%;
        top: 50%; /* Go back to top positioning for consistent animation math */
        transform: translate(-50%, 0); 
        background: white;
        color: #1e293b;
        border-radius: 14px;
        border: 2px solid #cbd5f5;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        font-weight: bold;
        box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        pointer-events: none;
        z-index: 5;
    }

    .paper.fly {
        opacity: 1 !important; /* Ensure it's visible when the class is added */
        animation: flyOut 1.3s ease-out forwards;
        }

    @keyframes flyOut {
        0% {
            transform: translate(-50%, 0) scale(0.4) rotate(-20deg);
        }
        70% {
            transform: translate(-50%, -260px) scale(0.4) rotate(0deg); /* keep small while moving up */
        }
        100% {
            transform: translate(-50%, -260px) scale(1.2); /* expand after fully out */
            width: 220px;
            height: 90px;
        }
    }

    .paper span {
      opacity: 0;
      animation: revealText 0.6s ease forwards;
      animation-delay: 1s;
      font-size: 32px;
    }

    @keyframes revealText { to { opacity: 1; } }

    button {
      padding: 12px 28px;
      border-radius: 16px;
      border: none;
      background: linear-gradient(to right, #ec4899, #6366f1);
      color: white;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 10px 25px rgba(0,0,0,0.4);
    }
  </style>
</head>
<body>
  <div class="scene">
    <div class="jar-wrapper" id="jarWrapper">
      <div class="lid" id="lid"></div>
      <div class="neck"></div>
      <div class="jar"><div class="ribbon"></div></div>
      <div class="paper" id="paper"><span>hello</span></div>
    </div>

    <button id="actionBtn" onclick="handleAction()">Shake the magic jar</button>
  </div>

  <script>
    const jar = document.getElementById("jarWrapper");
    const lid = document.getElementById("lid");
    const paper = document.getElementById("paper");
    const button = document.getElementById("actionBtn");

    let state = "idle"; // idle | revealed | animating

    const jarBody = document.querySelector(".jar");
    for (let i = 0; i < 24; i++) {
      const star = document.createElement("div");
      star.className = "star";
      star.style.left = Math.random() * 200 + "px";
      star.style.top = Math.random() * 260 + "px";
      star.style.background = `hsl(${Math.random() * 360}, 100%, 75%)`;
      star.style.animationDelay = Math.random() * 2 + "s";
      jarBody.appendChild(star);
    }

    function handleAction() {
      if (state === "idle") shakeJar();
      else if (state === "revealed") resetJar();
    }

    function shakeJar() {
      state = "animating";
      jar.classList.add("shake");
      lid.classList.remove("open");
      paper.classList.remove("fly");
      paper.style.opacity = 0;

      setTimeout(() => lid.classList.add("open"), 800);
      setTimeout(() => paper.classList.add("fly"), 1200);

      setTimeout(() => {
        jar.classList.remove("shake");
        button.textContent = "Reset jar";
        state = "revealed";
      }, 1600);
    }

    function resetJar() {
      lid.classList.remove("open");
      paper.classList.remove("fly");
      paper.style.opacity = 0;
      button.textContent = "Shake the magic jar";
      state = "idle";
    }
  </script>
</body>
</html>
